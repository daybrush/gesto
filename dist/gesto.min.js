/*
Copyright (c) 2019 Daybrush
name: gesto
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/gesto.git
version: 1.12.0
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).Gesto=n()}(this,function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(t,n)};var _=function(){return(_=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function i(t){return function(t,n){var i=n[0]-t[0],e=n[1]-t[1],r=Math.atan2(e,i);return 0<=r?r:r+2*Math.PI}([t[0].clientX,t[0].clientY],[t[1].clientX,t[1].clientY])/Math.PI*180}function P(t){return t?t.touches?function(t){for(var n=Math.min(t.length,2),i=[],e=0;e<n;++e)i.push(s(t[e]));return i}(t.touches):[s(t)]:[]}function o(t,n,i){var e=i.length,r=v(t,e),o=r.clientX,s=r.clientY,a=r.originalClientX,c=r.originalClientY,l=v(n,e),u=l.clientX,h=l.clientY,g=v(i,e);return{clientX:a,clientY:c,deltaX:o-u,deltaY:s-h,distX:o-g.clientX,distY:s-g.clientY}}function r(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function s(t){return{clientX:t.clientX,clientY:t.clientY}}function v(t,n){void 0===n&&(n=t.length);for(var i={clientX:0,clientY:0,originalClientX:0,originalClientY:0},e=0;e<n;++e){var r=t[e];i.originalClientX+="originalClientX"in r?r.originalClientX:r.clientX,i.originalClientY+="originalClientY"in r?r.originalClientY:r.clientY,i.clientX+=r.clientX,i.clientY+=r.clientY}return n?{clientX:i.clientX/n,clientY:i.clientY/n,originalClientX:i.originalClientX/n,originalClientY:i.originalClientY/n}:i}function a(t){return t&&"object"==typeof t}function X(){return Date.now?Date.now():(new Date).getTime()}function Y(t,n,i,e){t.addEventListener(n,i,e)}function w(t,n,i,e){t.removeEventListener(n,i,e)}var c=function(){return(c=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};var t=function(){function t(){this._events={}}var n=t.prototype;return n.on=function(t,n){if(a(t))for(var i in t)this.on(i,t[i]);else this._addEvent(t,n,{});return this},n.off=function(t,n){if(t)if(a(t))for(var i in t)this.off(i);else if(n){var e=this._events[t];if(e){var r=function(t,n,i){void 0===i&&(i=-1);for(var e=t.length,r=0;r<e;++r)if(n(t[r],r,t))return r;return i}(e,function(t){return t.listener===n});-1<r&&e.splice(r,1)}}else this._events[t]=[];else this._events={};return this},n.once=function(n,t){var i=this;return t&&this._addEvent(n,t,{once:!0}),new Promise(function(t){i._addEvent(n,t,{once:!0})})},n.emit=function(n,i){var e=this;void 0===i&&(i={});var t=this._events[n];if(!n||!t)return!0;var r=!1;return i.eventType=n,i.stop=function(){r=!0},i.currentTarget=this,function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;var e=Array(t),r=0;for(n=0;n<i;n++)for(var o=arguments[n],s=0,a=o.length;s<a;s++,r++)e[r]=o[s];return e}(t).forEach(function(t){t.listener(i),t.once&&e.off(n,t.listener)}),!r},n.trigger=function(t,n){return void 0===n&&(n={}),this.emit(t,n)},n._addEvent=function(t,n,i){var e=this._events;e[t]=e[t]||[],e[t].push(c({listener:n},i))},t}(),y=function(){function t(t){this.prevClients=[],this.startClients=[],this.movement=0,this.length=0,this.startClients=t,this.prevClients=t,this.length=t.length}var n=t.prototype;return n.getAngle=function(t){return void 0===t&&(t=this.prevClients),i(t)},n.getRotation=function(t){return void 0===t&&(t=this.prevClients),i(t)-i(this.startClients)},n.getPosition=function(t,n){void 0===t&&(t=this.prevClients);var i=o(t||this.prevClients,this.prevClients,this.startClients),e=i.deltaX,r=i.deltaY;return this.movement+=Math.sqrt(e*e+r*r),this.prevClients=t,i},n.getPositions=function(i){void 0===i&&(i=this.prevClients);var e=this.prevClients;return this.startClients.map(function(t,n){return o([i[n]],[e[n]],[t])})},n.getMovement=function(t){var n=this.movement;if(!t)return n;var i=v(t,this.length),e=v(this.prevClients,this.length),r=i.clientX-e.clientX,o=i.clientY-e.clientY;return Math.sqrt(r*r+o*o)+n},n.getDistance=function(t){return void 0===t&&(t=this.prevClients),r(t)},n.getScale=function(t){return void 0===t&&(t=this.prevClients),r(t)/r(this.startClients)},n.move=function(n,i){this.startClients.forEach(function(t){t.clientX-=n,t.clientY-=i})},t}(),k=["textarea","input"],n=function(c){function t(t,n){void 0===n&&(n={});var S=c.call(this)||this;S.options={},S.flag=!1,S.pinchFlag=!1,S.datas={},S.isDrag=!1,S.isPinch=!1,S.isMouse=!1,S.isTouch=!1,S.clientStores=[],S.targets=[],S.prevTime=0,S.doubleFlag=!1,S._dragFlag=!1,S._isMouseEvent=!1,S._isSecondaryButton=!1,S.onDragStart=function(t,n){if(void 0===n&&(n=!0),S.flag||!1!==t.cancelable){var i=S.options,e=i.container,r=i.pinchOutside,o=i.preventWheelClick,s=i.preventRightClick,a=i.preventDefault,c=i.checkInput,l=i.preventClickEventOnDragStart,u=i.preventClickEventOnDrag,h=i.preventClickEventByCondition,g=S.isTouch,v=!S.flag;if(S._isSecondaryButton=3===t.which||2===t.button,o&&(2===t.which||1===t.button)||s&&(3===t.which||2===t.button))return S.initDrag(),!1;if(v){var f=document.activeElement,d=t.target,p=d.tagName.toLowerCase(),C=-1<k.indexOf(p),m=d.isContentEditable;if(C||m){if(c||f===d)return!1;if(f&&m&&f.isContentEditable&&f.contains(d))return!1}else if((a||"touchstart"===t.type)&&f){var D=f.tagName;(f.isContentEditable||-1<k.indexOf(D))&&f.blur()}(l||u||h)&&Y(window,"click",S._onClick,!0),S.clientStores=[new y(P(t))],S.flag=!0,S.isDrag=!1,S._dragFlag=!0,S.datas={},S.doubleFlag=X()-S.prevTime<200,S._isMouseEvent=function(t){return t&&(-1<t.type.indexOf("mouse")||"button"in t||"which"in t)}(t),!1===S.emit("dragStart",_(_({datas:S.datas,inputEvent:t,isMouseEvent:S._isMouseEvent,isSecondaryButton:S._isSecondaryButton,isTrusted:n,isDouble:S.doubleFlag},S.getCurrentStore().getPosition()),{preventDefault:function(){t.preventDefault()},preventDrag:function(){S._dragFlag=!1}}))&&S.initDrag(),S.flag&&a&&t.preventDefault()}if(!S.flag)return!1;var E=0;if(v&&g&&r&&(E=setTimeout(function(){Y(e,"touchstart",S.onDragStart,{passive:!1})})),!v&&g&&r&&w(e,"touchstart",S.onDragStart),S.flag&&function(t){return t.touches&&2<=t.touches.length}(t)){if(clearTimeout(E),v&&t.touches.length!==t.changedTouches.length)return;S.pinchFlag||S.onPinchStart(t)}}},S.onDrag=function(t,n){if(S.flag){var i=P(t),e=S.moveClients(i,t,!1);if(S._dragFlag){if(S.pinchFlag||e.deltaX||e.deltaY)if(!1===S.emit("drag",_(_({},e),{isScroll:!!n,inputEvent:t})))return void S.stop();S.pinchFlag&&S.onPinch(t,i)}S.getCurrentStore().getPosition(i,!0)}},S.onDragEnd=function(t){if(S.flag){var n=S.options,i=n.pinchOutside,e=n.container,r=n.preventClickEventOnDrag,o=n.preventClickEventOnDragStart,s=n.preventClickEventByCondition,a=S.isDrag;(r||o||s)&&requestAnimationFrame(function(){S._allowClickEvent()}),s||o||!r||a||S._allowClickEvent(),S.isTouch&&i&&w(e,"touchstart",S.onDragStart),S.pinchFlag&&S.onPinchEnd(t);var c=(null==t?void 0:t.touches)?P(t):[];0!==c.length&&S.options.keepDragging?S._addStore(new y(c)):S.flag=!1;var l=S._getPosition(),u=X(),h=!a&&S.doubleFlag;S.prevTime=a||h?0:u,S.flag||(S.emit("dragEnd",_({datas:S.datas,isDouble:h,isDrag:a,isClick:!a,isMouseEvent:S._isMouseEvent,isSecondaryButton:S._isSecondaryButton,inputEvent:t},l)),S.clientStores=[])}},S.onBlur=function(){S.onDragEnd()},S._allowClickEvent=function(){w(window,"click",S._onClick,!0)},S._onClick=function(t){var n=S.options.preventClickEventByCondition;null!=n&&n(t)||(t.stopPropagation(),t.preventDefault())},S._onContextMenu=function(t){S.options.preventRightClick?S.onDragEnd(t):t.preventDefault()};var i=[].concat(t);S.options=_({checkInput:!1,container:1<i.length?window:i[0],preventRightClick:!0,preventWheelClick:!0,preventClickEventOnDragStart:!1,preventClickEventOnDrag:!1,preventClickEventByCondition:null,preventDefault:!0,checkWindowBlur:!1,keepDragging:!1,pinchThreshold:0,events:["touch","mouse"]},n);var e=S.options,r=e.container,o=e.events,s=e.checkWindowBlur;if(S.isTouch=-1<o.indexOf("touch"),S.isMouse=-1<o.indexOf("mouse"),S.targets=i,S.isMouse&&(i.forEach(function(t){Y(t,"mousedown",S.onDragStart)}),Y(r,"mousemove",S.onDrag),Y(r,"mouseup",S.onDragEnd),Y(r,"contextmenu",S._onContextMenu)),s&&Y(window,"blur",S.onBlur),S.isTouch){var a={passive:!1};i.forEach(function(t){Y(t,"touchstart",S.onDragStart,a)}),Y(r,"touchmove",S.onDrag,a),Y(r,"touchend",S.onDragEnd,a),Y(r,"touchcancel",S.onDragEnd,a)}return S}!function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(t,c);var n=t.prototype;return n.stop=function(){this.isDrag=!1,this.flag=!1,this.clientStores=[],this.datas={}},n.getMovement=function(t){return this.getCurrentStore().getMovement(t)+this.clientStores.slice(1).reduce(function(t,n){return t+n.movement},0)},n.isDragging=function(){return this.isDrag},n.isFlag=function(){return this.flag},n.isPinchFlag=function(){return this.pinchFlag},n.isDoubleFlag=function(){return this.doubleFlag},n.isPinching=function(){return this.isPinch},n.scrollBy=function(t,n,i,e){void 0===e&&(e=!0),this.flag&&(this.clientStores[0].move(t,n),e&&this.onDrag(i,!0))},n.move=function(t,n){var e=t[0],r=t[1],i=this.getCurrentStore().prevClients;return this.moveClients(i.map(function(t){var n=t.clientX,i=t.clientY;return{clientX:n+e,clientY:i+r,originalClientX:n,originalClientY:i}}),n,!0)},n.triggerDragStart=function(t){this.onDragStart(t,!1)},n.setEventDatas=function(t){var n=this.datas;for(var i in t)n[i]=t[i];return this},n.getCurrentEvent=function(t){return _(_({datas:this.datas},this._getPosition()),{movement:this.getMovement(),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:t})},n.getEventDatas=function(){return this.datas},n.unset=function(){var n=this,t=this.targets,i=this.options.container;this.off(),w(window,"blur",this.onBlur),this.isMouse&&(t.forEach(function(t){w(t,"mousedown",n.onDragStart)}),w(i,"mousemove",this.onDrag),w(i,"mouseup",this.onDragEnd),w(i,"contextmenu",this._onContextMenu)),this.isTouch&&(t.forEach(function(t){w(t,"touchstart",n.onDragStart)}),w(i,"touchstart",this.onDragStart),w(i,"touchmove",this.onDrag),w(i,"touchend",this.onDragEnd),w(i,"touchcancel",this.onDragEnd))},n.onPinchStart=function(t){var n=this.options.pinchThreshold;if(!(this.isDrag&&this.getMovement()>n)){var i=new y(P(t));this.pinchFlag=!0,this._addStore(i),!1===this.emit("pinchStart",_(_({datas:this.datas,angle:i.getAngle(),touches:this.getCurrentStore().getPositions()},i.getPosition()),{inputEvent:t}))&&(this.pinchFlag=!1)}},n.onPinch=function(t,n){if(this.flag&&this.pinchFlag&&!(n.length<2)){var i=this.getCurrentStore();this.isPinch=!0,this.emit("pinch",_(_({datas:this.datas,movement:this.getMovement(n),angle:i.getAngle(n),rotation:i.getRotation(n),touches:i.getPositions(n),scale:i.getScale(n),distance:i.getDistance(n)},i.getPosition(n)),{inputEvent:t}))}},n.onPinchEnd=function(t){if(this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var i=this.getCurrentStore();this.emit("pinchEnd",_(_({datas:this.datas,isPinch:n,touches:i.getPositions()},i.getPosition()),{inputEvent:t}))}},n.initDrag=function(){this.clientStores=[],this.pinchFlag=!1,this.doubleFlag=!1,this.prevTime=0,this.flag=!1,this._allowClickEvent()},n.getCurrentStore=function(){return this.clientStores[0]},n.moveClients=function(t,n,i){var e=this._getPosition(t,i);return(e.deltaX||e.deltaY)&&(this.isDrag=!0),_(_({datas:this.datas},e),{movement:this.getMovement(t),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,isMouseEvent:this._isMouseEvent,isSecondaryButton:this._isSecondaryButton,inputEvent:n})},n._addStore=function(t){this.clientStores.splice(0,0,t)},n._getPosition=function(t,n){var i=this.getCurrentStore().getPosition(t,n),e=this.clientStores.slice(1).reduce(function(t,n){var i=n.getPosition();return t.distX+=i.distX,t.distY+=i.distY,t},i),r=e.distX,o=e.distY;return _(_({},i),{distX:r,distY:o})},t}(t),l={default:n};for(var u in l)n[u]=l[u];return n});
//# sourceMappingURL=gesto.min.js.map
