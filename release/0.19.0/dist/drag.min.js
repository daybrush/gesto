/*
Copyright (c) 2019 Daybrush
name: @daybrush/drag
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/drag.git
version: 0.19.0
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Dragger=i()}(this,function(){"use strict";var C=function(){return(C=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};function l(t){return function(t,i){var n=i[0]-t[0],e=i[1]-t[1],s=Math.atan2(e,n);return 0<=s?s:s+2*Math.PI}([t[0].clientX,t[0].clientY],[t[1].clientX,t[1].clientY])/Math.PI*180}function u(t,i,n,e){var s=v(t),a=v(i),r=v(e);return X(o(e[0],h(s,r)),o(e[0],h(a,r)),n[0])}function E(t){return t.touches?p(t.touches):[s(t)]}function X(t,i,n){var e=t.clientX,s=t.clientY;return{clientX:e,clientY:s,deltaX:e-i.clientX,deltaY:s-i.clientY,distX:e-n.clientX,distY:s-n.clientY}}function f(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}function g(t,n,e){return t.map(function(t,i){return X(t,n[i],e[i])})}function p(t){for(var i=Math.min(t.length,2),n=[],e=0;e<i;++e)n.push(s(t[e]));return n}function s(t){return{clientX:t.clientX,clientY:t.clientY}}function v(t){return 1===t.length?t[0]:{clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function o(t,i){return{clientX:t.clientX+i.clientX,clientY:t.clientY+i.clientY}}function h(t,i){return{clientX:t.clientX-i.clientX,clientY:t.clientY-i.clientY}}function Y(){return Date.now?Date.now():(new Date).getTime()}function P(t,i,n,e){t.addEventListener(i,n,e)}function y(t,i,n){t.removeEventListener(i,n)}var T=["textarea","input"],n=function(){function t(t,i){var m=this;void 0===i&&(i={}),this.options={},this.flag=!1,this.pinchFlag=!1,this.datas={},this.isDrag=!1,this.isPinch=!1,this.isMouse=!1,this.isTouch=!1,this.prevClients=[],this.startClients=[],this.movement=0,this.startPinchClients=[],this.startDistance=0,this.customDist=[0,0],this.targets=[],this.prevTime=0,this.isDouble=!1,this.startRotate=0,this.onDragStart=function(t,i){if(void 0===i&&(i=!0),m.flag||!1!==t.cancelable){var n=m.options,e=n.container,s=n.pinchOutside,a=n.dragstart,r=n.preventRightClick,o=n.preventDefault,h=n.checkInput,c=m.isTouch;if(!m.flag){var l=document.activeElement,u=t.target,f=u.tagName.toLowerCase(),g=-1<T.indexOf(f),p=u.isContentEditable;if(g||p){if(h||l===u)return!1;if(l&&p&&l.isContentEditable&&l.contains(u))return!1}else if((o||"touchstart"===t.type)&&l){var v=l.tagName;(l.isContentEditable||-1<T.indexOf(v))&&l.blur()}}if(!m.flag&&c&&s&&setTimeout(function(){P(e,"touchstart",m.onDragStart,{passive:!1})}),m.flag&&c&&s&&y(e,"touchstart",m.onDragStart),function(t){return t.touches&&2<=t.touches.length}(t)){if(!m.flag&&t.touches.length!==t.changedTouches.length)return;m.pinchFlag||m.onPinchStart(t)}if(!m.flag){var d=m.startClients[0]?m.startClients:E(t);m.customDist=[0,0],m.flag=!0,m.isDrag=!1,m.startClients=d,m.prevClients=d,m.datas={};var D=X(d[m.movement=0],m.prevClients[0],m.startClients[0]);if(r&&(3===t.which||2===t.button))return m.initDrag(),!1;!1===(a&&a(C({type:"dragstart",datas:m.datas,inputEvent:t,isTrusted:i},D)))&&m.initDrag(),m.isDouble=Y()-m.prevTime<200,m.flag&&o&&t.preventDefault()}}},this.onDrag=function(t,i){if(m.flag){var n=E(t);m.pinchFlag&&m.onPinch(t,n);var e=m.move([0,0],t,n);if(e&&(e.deltaX||e.deltaY)){var s=m.options.drag;s&&s(C({},e,{isScroll:!!i,inputEvent:t}))}}},this.onDragEnd=function(t){if(m.flag){var i=m.options,n=i.dragend,e=i.pinchOutside,s=i.container;m.isTouch&&e&&y(s,"touchstart",m.onDragStart),m.pinchFlag&&m.onPinchEnd(t),m.flag=!1;var a=m.prevClients,r=m.startClients,o=m.pinchFlag?u(a,a,r,m.startPinchClients):X(a[0],a[0],r[0]),h=Y(),c=!m.isDrag&&m.isDouble;m.prevTime=m.isDrag||c?0:h,m.startClients=[],m.prevClients=[],n&&n(C({type:"dragend",datas:m.datas,isDouble:c,isDrag:m.isDrag,inputEvent:t},o))}};var n=[].concat(t);this.options=C({checkInput:!1,container:1<n.length?window:n[0],preventRightClick:!0,preventDefault:!0,pinchThreshold:0,events:["touch","mouse"]},i);var e=this.options,s=e.container,a=e.events;if(this.isTouch=-1<a.indexOf("touch"),this.isMouse=-1<a.indexOf("mouse"),this.customDist=[0,0],this.targets=n,this.isMouse&&(n.forEach(function(t){P(t,"mousedown",m.onDragStart)}),P(s,"mousemove",this.onDrag),P(s,"mouseup",this.onDragEnd),P(s,"contextmenu",this.onDragEnd)),this.isTouch){var r={passive:!1};n.forEach(function(t){P(t,"touchstart",m.onDragStart,r)}),P(s,"touchmove",this.onDrag,r),P(s,"touchend",this.onDragEnd,r),P(s,"touchcancel",this.onDragEnd,r)}}var i=t.prototype;return i.isDragging=function(){return this.isDrag},i.isFlag=function(){return this.flag},i.isPinchFlag=function(){return this.pinchFlag},i.isPinching=function(){return this.isPinch},i.scrollBy=function(i,n,t,e){void 0===e&&(e=!0),this.flag&&(this.startClients.forEach(function(t){t.clientX-=i,t.clientY-=n}),this.prevClients.forEach(function(t){t.clientX-=i,t.clientY-=n}),e&&this.onDrag(t,!0))},i.move=function(t,i,n){var e=t[0],s=t[1];void 0===n&&(n=this.prevClients);var a=this.customDist,r=this.prevClients,o=this.startClients,h=this.pinchFlag?u(n,r,o,this.startPinchClients):X(n[0],r[0],o[0]);a[0]+=e,a[1]+=s,h.deltaX+=e,h.deltaY+=s;var c=h.deltaX,l=h.deltaY;return h.distX+=a[0],h.distY+=a[1],this.movement+=Math.sqrt(c*c+l*l),this.prevClients=n,this.isDrag=!0,C({type:"drag",datas:this.datas},h,{movement:this.movement,isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:i})},i.onPinchStart=function(t){var i,n,e=this.options,s=e.pinchstart,a=e.pinchThreshold;if(!(this.isDrag&&this.movement>a)){var r=p(t.changedTouches);if(this.pinchFlag=!0,(i=this.startClients).push.apply(i,r),(n=this.prevClients).push.apply(n,r),this.startDistance=f(this.prevClients),this.startPinchClients=this.prevClients.slice(),s){var o=this.prevClients,h=v(o),c=X(h,h,h);this.startRotate=l(o),s(C({type:"pinchstart",datas:this.datas,angle:this.startRotate,touches:g(o,o,o)},c,{inputEvent:t}))}}},i.onPinch=function(t,i){if(this.flag&&this.pinchFlag&&!(i.length<2)){this.isPinch=!0;var n=this.options.pinch;if(n){var e=this.prevClients,s=this.startClients,a=X(v(i),v(e),v(s)),r=l(i),o=f(i);n(C({type:"pinch",datas:this.datas,movement:this.movement,angle:r,rotation:r-this.startRotate,touches:g(i,e,s),scale:o/this.startDistance,distance:o},a,{inputEvent:t}))}}},i.onPinchEnd=function(t){if(this.flag&&this.pinchFlag){var i=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var n=this.options.pinchend;if(n){var e=this.prevClients,s=this.startClients,a=X(v(e),v(e),v(s));n(C({type:"pinchend",datas:this.datas,isPinch:i,touches:g(e,e,s)},a,{inputEvent:t})),this.isPinch=!1,this.pinchFlag=!1}}},i.triggerDragStart=function(t){this.onDragStart(t,!1)},i.unset=function(){var i=this,t=this.targets,n=this.options.container;this.isMouse&&(t.forEach(function(t){y(t,"mousedown",i.onDragStart)}),y(n,"mousemove",this.onDrag),y(n,"mouseup",this.onDragEnd),y(n,"contextmenu",this.onDragEnd)),this.isTouch&&(t.forEach(function(t){y(t,"touchstart",i.onDragStart)}),y(n,"touchstart",this.onDragStart),y(n,"touchmove",this.onDrag),y(n,"touchend",this.onDragEnd),y(n,"touchcancel",this.onDragEnd))},i.initDrag=function(){this.startClients=[],this.prevClients=[],this.flag=!1},t}();var t={default:n,drag:function(t,i){return new n(t,i)}};for(var i in t)n[i]=t[i];return n});
//# sourceMappingURL=drag.min.js.map
