{"version":3,"file":"gesto.js","sources":["../src/utils.ts","../src/ClientStore.ts","../src/Gesto.ts","../src/index.umd.ts"],"sourcesContent":["import { Client, Position } from \"./types\";\nimport { IArrayFormat } from \"@daybrush/utils\";\n\nexport function getRad(pos1: number[], pos2: number[]) {\n    const distX = pos2[0] - pos1[0];\n    const distY = pos2[1] - pos1[1];\n    const rad = Math.atan2(distY, distX);\n\n    return rad >= 0 ? rad : rad + Math.PI * 2;\n}\n\nexport function getRotatiion(touches: Client[]) {\n    return getRad([\n        touches[0].clientX,\n        touches[0].clientY,\n    ], [\n        touches[1].clientX,\n        touches[1].clientY,\n    ]) / Math.PI * 180;\n}\n\nexport function isMultiTouch(e: any): e is TouchEvent {\n    return e.touches && e.touches.length >= 2;\n}\nexport function getEventClients(e: any): Client[] {\n    if (e.touches) {\n        return getClients(e.touches);\n    } else {\n        return [getClient(e)];\n    }\n}\nexport function getPosition(clients: Client[], prevClients: Client[], startClients: Client[]): Position {\n    const length = startClients.length;\n    const {\n        clientX, clientY,\n        originalClientX, originalClientY,\n    } = getAverageClient(clients, length);\n    const {\n        clientX: prevX,\n        clientY: prevY,\n    } = getAverageClient(prevClients, length);\n\n    const {\n        clientX: startX,\n        clientY: startY,\n    } = getAverageClient(startClients, length);\n    const deltaX = clientX - prevX;\n    const deltaY = clientY - prevY;\n    const distX = clientX - startX;\n    const distY = clientY - startY;\n\n    return {\n        clientX: originalClientX!,\n        clientY: originalClientY!,\n        deltaX,\n        deltaY,\n        distX,\n        distY,\n    };\n}\nexport function getDist(clients: Client[]) {\n    return Math.sqrt(\n        Math.pow(clients[0].clientX - clients[1].clientX, 2)\n        + Math.pow(clients[0].clientY - clients[1].clientY, 2),\n    );\n}\nexport function getClients(touches: IArrayFormat<Touch>) {\n    const length = Math.min(touches.length, 2);\n    const clients = [];\n\n    for (let i = 0; i < length; ++i) {\n        clients.push(getClient(touches[i]));\n    }\n    return clients;\n}\nexport function getClient(e: MouseEvent | Touch): Client {\n    return {\n        clientX: e.clientX,\n        clientY: e.clientY,\n    };\n}\nexport function getAverageClient(clients: Client[], length = clients.length): Required<Client> {\n    const sumClient: Required<Client> = {\n        clientX: 0,\n        clientY: 0,\n        originalClientX: 0,\n        originalClientY: 0,\n    };\n    for (let i = 0; i < length; ++i) {\n        const client = clients[i];\n\n        sumClient.originalClientX += \"originalClientX\" in client ? client.originalClientX! : client.clientX;\n        sumClient.originalClientY += \"originalClientY\" in client ? client.originalClientY! : client.clientY;\n        sumClient.clientX += client.clientX;\n        sumClient.clientY += client.clientY;\n    }\n    if (!length) {\n        return sumClient;\n    }\n    return {\n        clientX: sumClient.clientX / length,\n        clientY: sumClient.clientY / length,\n        originalClientX: sumClient.originalClientX / length,\n        originalClientY: sumClient.originalClientY / length,\n    };\n}\nexport function plueClient(client1: Client, client2: Client) {\n    return {\n        clientX: (client1.clientX + client2.clientX),\n        clientY: (client1.clientY + client2.clientY),\n    };\n}\n\nexport function minusClient(client1: Client, client2: Client) {\n    return {\n        clientX: (client1.clientX - client2.clientX),\n        clientY: (client1.clientY - client2.clientY),\n    };\n}\n","import { Client } from \"./types\";\nimport { getPosition, getDist, getRotatiion, getAverageClient } from \"./utils\";\n\nexport class ClientStore {\n    public prevClients: Client[] = [];\n    public startClients: Client[] = [];\n    public movement = 0;\n    public length  = 0;\n    constructor(clients: Client[]) {\n        this.startClients = clients;\n        this.prevClients = clients;\n        this.length = clients.length;\n    }\n    public addClients(clients: Client[] = this.prevClients) {\n        const position = this.getPosition(clients);\n        const { deltaX, deltaY } = position;\n\n        this.movement += Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n        this.prevClients = clients;\n\n        return position;\n    }\n    public getAngle(clients: Client[] = this.prevClients) {\n        return getRotatiion(clients);\n    }\n    public getRotation(clients: Client[] = this.prevClients) {\n        return getRotatiion(clients) - getRotatiion(this.startClients);\n    }\n    public getPosition(clients?: Client[]) {\n        return getPosition(clients || this.prevClients, this.prevClients, this.startClients);\n    }\n    public getPositions(clients: Client[] = this.prevClients) {\n        const prevClients = this.prevClients;\n\n        return this.startClients.map((startClient, i) => getPosition([clients[i]], [prevClients[i]], [startClient]));\n    }\n    public getMovement(clients?: Client[]) {\n        const movement = this.movement;\n\n        if (!clients) {\n            return movement;\n        }\n        const currentClient = getAverageClient(clients, this.length);\n        const prevClient = getAverageClient(this.prevClients, this.length);\n        const deltaX = currentClient.clientX - prevClient.clientX;\n        const deltaY = currentClient.clientY - prevClient.clientY;\n\n        return Math.sqrt(deltaX * deltaX + deltaY * deltaY) + movement;\n    }\n    public getDistance(clients = this.prevClients) {\n        return getDist(clients);\n    }\n    public getScale(clients = this.prevClients) {\n        return getDist(clients) / getDist(this.startClients);\n    }\n    public move(deltaX: number, deltaY: number) {\n        this.startClients.forEach(client => {\n            client.clientX -= deltaX;\n            client.clientY -= deltaY;\n        });\n        this.prevClients.forEach(client => {\n            client.clientX -= deltaX;\n            client.clientY -= deltaY;\n        });\n    }\n}\n","import { Client, OnDrag, GestoOptions, GestoEvents, ComponentTriggerType } from \"./types\";\nimport {\n    getEventClients, isMultiTouch,\n} from \"./utils\";\nimport Component from \"@egjs/component\";\nimport { addEvent, removeEvent, now } from \"@daybrush/utils\";\nimport { ClientStore } from \"./ClientStore\";\n\nconst INPUT_TAGNAMES = [\"textarea\", \"input\"];\n/**\n * You can set up drag, pinch events in any browser.\n */\nclass Gesto extends Component {\n    public options: GestoOptions = {};\n    private flag = false;\n    private pinchFlag = false;\n    private datas = {};\n    private isDrag = false;\n    private isPinch = false;\n    private isMouse = false;\n    private isTouch = false;\n    private clientStores: ClientStore[] = [];\n    private targets: Array<Element | Window> = [];\n    private prevTime: number = 0;\n    private isDouble: boolean = false;\n\n    /**\n     *\n     */\n    constructor(targets: Array<Element | Window> | Element | Window, options: GestoOptions = {}) {\n        super();\n        const elements = [].concat(targets as any) as Array<Element | Window>;\n        this.options = {\n            checkInput: false,\n            container: elements.length > 1 ? window : elements[0],\n            preventRightClick: true,\n            preventDefault: true,\n            pinchThreshold: 0,\n            events: [\"touch\", \"mouse\"],\n            ...options,\n        };\n\n        const { container, events } = this.options;\n\n        this.isTouch = events!.indexOf(\"touch\") > -1;\n        this.isMouse = events!.indexOf(\"mouse\") > -1;\n        this.targets = elements;\n\n        if (this.isMouse) {\n            elements.forEach(el => {\n                addEvent(el, \"mousedown\", this.onDragStart);\n            });\n            addEvent(container!, \"mousemove\", this.onDrag);\n            addEvent(container!, \"mouseup\", this.onDragEnd);\n            addEvent(container!, \"contextmenu\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            const passive = {\n                passive: false,\n            };\n            elements.forEach(el => {\n                addEvent(el, \"touchstart\", this.onDragStart, passive);\n            });\n            addEvent(container!, \"touchmove\", this.onDrag, passive);\n            addEvent(container!, \"touchend\", this.onDragEnd, passive);\n            addEvent(container!, \"touchcancel\", this.onDragEnd, passive);\n        }\n    }\n    /**\n     * The total moved distance\n     */\n    public getMovement(clients?: Client[]) {\n        return this.getCurrentStore().getMovement(clients) + this.clientStores.slice(1).reduce((prev, cur) => {\n            return prev + cur.movement;\n        },  0);\n    }\n    /**\n     * Whether to drag\n     */\n    public isDragging(): boolean {\n        return this.isDrag;\n    }\n    /**\n     * Whether to start drag\n     */\n    public isFlag(): boolean {\n        return this.flag;\n    }\n    /**\n     * Whether to start pinch\n     */\n    public isPinchFlag() {\n        return this.pinchFlag;\n    }\n    /**\n     * Whether to pinch\n     */\n    public isPinching() {\n        return this.isPinch;\n    }\n    /**\n     * If a scroll event occurs, it is corrected by the scroll distance.\n     */\n    public scrollBy(deltaX: number, deltaY: number, e: any, isCallDrag: boolean = true) {\n        if (!this.flag) {\n            return;\n        }\n        this.clientStores[0].move(deltaX, deltaY);\n        isCallDrag && this.onDrag(e, true);\n    }\n    /**\n     * Create a virtual drag event.\n     */\n    public move([deltaX, deltaY]: number[], inputEvent: any): ComponentTriggerType<OnDrag> {\n        const store = this.getCurrentStore();\n        const nextClients = store.prevClients;\n\n        return this.moveClients(nextClients.map(({ clientX, clientY }) => {\n            return {\n                clientX: clientX + deltaX,\n                clientY: clientY + deltaY,\n                originalClientX: clientX,\n                originalClientY: clientY,\n            };\n        }), inputEvent, true);\n    }\n    /**\n     * The dragStart event is triggered by an external event.\n     */\n    public triggerDragStart(e: any) {\n        this.onDragStart(e, false);\n    }\n    /**\n     * Unset Gesto\n     */\n    public unset() {\n        const targets = this.targets;\n        const container = this.options.container!;\n\n        this.off();\n        if (this.isMouse) {\n            targets.forEach(target => {\n                removeEvent(target, \"mousedown\", this.onDragStart);\n            });\n            removeEvent(container, \"mousemove\", this.onDrag);\n            removeEvent(container, \"mouseup\", this.onDragEnd);\n            removeEvent(container, \"contextmenu\", this.onDragEnd);\n        }\n        if (this.isTouch) {\n            targets.forEach(target => {\n                removeEvent(target, \"touchstart\", this.onDragStart);\n            });\n            removeEvent(container, \"touchstart\", this.onDragStart);\n            removeEvent(container, \"touchmove\", this.onDrag);\n            removeEvent(container, \"touchend\", this.onDragEnd);\n            removeEvent(container, \"touchcancel\", this.onDragEnd);\n        }\n    }\n    public onDragStart = (e: any, isTrusted = true) => {\n        if (!this.flag && e.cancelable === false) {\n            return;\n        }\n        const { container, pinchOutside, preventRightClick, preventDefault, checkInput } = this.options;\n        const isTouch = this.isTouch;\n        const isDragStart = !this.flag;\n\n        if (isDragStart) {\n            const activeElement = document.activeElement as HTMLElement;\n            const target = e.target as HTMLElement;\n            const tagName = target.tagName.toLowerCase();\n            const hasInput = INPUT_TAGNAMES.indexOf(tagName) > -1;\n            const hasContentEditable = target.isContentEditable;\n\n            if (hasInput || hasContentEditable) {\n                if (checkInput || activeElement === target) {\n                    // force false or already focused.\n                    return false;\n                }\n                if (\n                    activeElement\n                    && hasContentEditable\n                    && activeElement.isContentEditable\n                    && activeElement.contains(target)\n                ) {\n                    return false;\n                }\n            } else if ((preventDefault || e.type === \"touchstart\") && activeElement) {\n                const activeTagName = activeElement.tagName;\n                if (activeElement.isContentEditable || INPUT_TAGNAMES.indexOf(activeTagName) > -1) {\n                    activeElement.blur();\n                }\n            }\n            this.clientStores = [new ClientStore(getEventClients(e))];\n            this.flag = true;\n            this.isDrag = false;\n            this.datas = {};\n\n            if (preventRightClick && (e.which === 3 || e.button === 2)) {\n                this.initDrag();\n                return false;\n            }\n            const result = this.trigger(\"dragStart\", {\n                datas: this.datas,\n                inputEvent: e,\n                isTrusted,\n                ...this.getCurrentStore().getPosition(),\n            });\n            if (result === false) {\n                this.initDrag();\n            }\n            this.isDouble = now() - this.prevTime < 200;\n            this.flag && preventDefault && e.preventDefault();\n        }\n        if (!this.flag) {\n            return false;\n        }\n        let timer = 0;\n\n        if (isDragStart && isTouch && pinchOutside) {\n            timer = setTimeout(() => {\n                addEvent(container!, \"touchstart\", this.onDragStart, { passive: false });\n            });\n        }\n        if (!isDragStart && isTouch && pinchOutside) {\n            removeEvent(container!, \"touchstart\", this.onDragStart);\n        }\n        if (this.flag && isMultiTouch(e)) {\n            clearTimeout(timer);\n            if (isDragStart && (e.touches.length !== e.changedTouches.length)) {\n                return;\n            }\n            if (!this.pinchFlag) {\n                this.onPinchStart(e);\n            }\n        }\n\n    }\n    public onDrag = (e: any, isScroll?: boolean) => {\n        if (!this.flag) {\n            return;\n        }\n        const clients = getEventClients(e);\n        const result = this.moveClients(clients, e, false);\n\n        if (this.pinchFlag || result.deltaX || result.deltaY) {\n            this.trigger(\"drag\", {\n                ...result,\n                isScroll: !!isScroll,\n                inputEvent: e,\n            });\n        }\n        if (this.pinchFlag) {\n            this.onPinch(e, clients);\n        }\n\n        this.getCurrentStore().addClients(clients);\n    }\n    public onDragEnd = (e: any) => {\n        if (!this.flag) {\n            return;\n        }\n        const { pinchOutside, container } = this.options;\n        if (this.isTouch && pinchOutside) {\n            removeEvent(container!, \"touchstart\", this.onDragStart);\n        }\n\n        this.flag = false;\n\n        const position = this.getCurrentStore().getPosition();\n\n        const currentTime = now();\n        const isDouble = !this.isDrag && this.isDouble;\n\n        this.prevTime = this.isDrag || isDouble ? 0 : currentTime;\n\n        this.trigger(\"dragEnd\", {\n            datas: this.datas,\n            isDouble,\n            isDrag: this.isDrag,\n            inputEvent: e,\n            ...position,\n        });\n        if (this.pinchFlag) {\n            this.onPinchEnd(e);\n        }\n        this.clientStores = [];\n    }\n    public onPinchStart(e: TouchEvent) {\n        const { pinchThreshold } = this.options;\n\n        if (this.isDrag && this.getMovement() > pinchThreshold!) {\n            return;\n        }\n        const store = new ClientStore(getEventClients(e));\n\n        this.pinchFlag = true;\n        this.clientStores.splice(0, 0, store);\n\n        this.trigger(\"pinchStart\", {\n            datas: this.datas,\n            angle: store.getAngle(),\n            touches: this.getCurrentStore().getPositions(),\n            ...store.getPosition(),\n            inputEvent: e,\n        });\n    }\n    public onPinch(e: TouchEvent, clients: Client[]) {\n        if (!this.flag || !this.pinchFlag || clients.length < 2) {\n            return;\n        }\n\n        const store = this.getCurrentStore();\n        this.isPinch = true;\n\n        this.trigger(\"pinch\", {\n            datas: this.datas,\n            movement: this.getMovement(clients),\n            angle: store.getAngle(clients),\n            rotation: store.getRotation(clients),\n            touches: store.getPositions(clients),\n            scale: store.getScale(clients),\n            distance: store.getDistance(clients),\n            ...store.getPosition(clients),\n            inputEvent: e,\n        });\n    }\n    public onPinchEnd(e: TouchEvent) {\n        if (!this.pinchFlag) {\n            return;\n        }\n        const isPinch = this.isPinch;\n\n        this.isPinch = false;\n        this.pinchFlag = false;\n        const store = this.getCurrentStore();\n        this.trigger(\"pinchEnd\", {\n            datas: this.datas,\n            isPinch,\n            touches: store.getPositions(),\n            ...store.getPosition(),\n            inputEvent: e,\n        });\n        this.isPinch = false;\n        this.pinchFlag = false;\n    }\n\n    private initDrag() {\n        this.clientStores = [];\n        this.pinchFlag = false;\n        this.flag = false;\n    }\n    private getCurrentStore() {\n        return this.clientStores[0];\n    }\n    private moveClients(clients: Client[], inputEvent: any, isAdd: boolean): ComponentTriggerType<OnDrag> {\n        const store = this.getCurrentStore();\n        const position = store[isAdd ? \"addClients\" : \"getPosition\"](clients);\n\n        this.isDrag = true;\n\n        return {\n            datas: this.datas,\n            ...position,\n            movement: this.getMovement(clients),\n            isDrag: this.isDrag,\n            isPinch: this.isPinch,\n            isScroll: false,\n            inputEvent,\n        };\n    }\n}\n\ninterface Gesto {\n    on<T extends keyof GestoEvents>(\n        eventName: T, handlerToAttach: (event: GestoEvents[T]) => any): this;\n    on(eventName: string, handlerToAttach: (event: { [key: string]: any }) => any): this;\n    on(events: { [key: string]: (event: { [key: string]: any }) => any }): this;\n    trigger<T extends keyof GestoEvents>(eventName: T, param: ComponentTriggerType<GestoEvents[T]>): boolean;\n    trigger(eventName: string, param: { [key: string]: any }): boolean;\n}\nexport default Gesto;\n","\nimport Dragger, * as modules from \"./index\";\n\nfor (const name in modules) {\n    (Dragger as any)[name] = (modules as any)[name];\n}\n\nexport default Dragger;\n"],"names":["getRad","pos1","pos2","distX","distY","rad","Math","atan2","PI","getRotatiion","touches","clientX","clientY","isMultiTouch","e","length","getEventClients","getClients","getClient","getPosition","clients","prevClients","startClients","_a","originalClientX","originalClientY","_b","prevX","prevY","_c","startX","startY","deltaX","deltaY","getDist","sqrt","pow","min","i","push","getAverageClient","sumClient","client","position","movement","map","startClient","currentClient","prevClient","forEach","INPUT_TAGNAMES","tslib_1","targets","options","_super","_this","isTrusted","flag","cancelable","container","pinchOutside","preventRightClick","preventDefault","checkInput","isTouch","isDragStart","activeElement","document","target","tagName","toLowerCase","hasInput","indexOf","hasContentEditable","isContentEditable","contains","type","activeTagName","blur","clientStores","ClientStore","isDrag","datas","which","button","initDrag","result","trigger","inputEvent","getCurrentStore","isDouble","now","prevTime","timer","setTimeout","addEvent","onDragStart","passive","removeEvent","clearTimeout","changedTouches","pinchFlag","onPinchStart","isScroll","moveClients","onPinch","addClients","currentTime","onPinchEnd","elements","concat","window","pinchThreshold","events","isMouse","el","onDrag","onDragEnd","passive_1","getMovement","slice","reduce","prev","cur","isPinch","isCallDrag","move","store","nextClients","off","splice","angle","getAngle","getPositions","rotation","getRotation","scale","getScale","distance","getDistance","isAdd","Component","name","modules","Dragger"],"mappings":"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"}